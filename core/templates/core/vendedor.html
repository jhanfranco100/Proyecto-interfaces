{% extends 'core/basetemplates.html' %}
{% block content %}
<div class="container">
  <div class="row">
    <div class="col-md-12">
      <h3 class="mb-4">
        <i class="fas fa-user-tie me-2"></i>Panel de Vendedor
      </h3>
      
      <div class="row mb-4">
        <div class="col-12">
          <div class="d-grid gap-2 d-md-flex justify-content-md-end">
            <a href="{% url 'vendedor_venta' %}" class="btn btn-success btn-lg">
              <i class="fas fa-cash-register me-2"></i>Realizar Venta
            </a>
          </div>
        </div>
      </div>
      
      <div class="row">
        <div class="col-md-6">
          <div class="card">
            <div class="card-header">
              <h5><i class="fas fa-calculator me-2"></i>Calculadora de Precios</h5>
            </div>
            <div class="card-body">
              <p class="text-muted">Seleccione un producto y cantidad para calcular el total.</p>
              <form class="row g-3">
                <div class="col-md-8">
                  <label class="form-label">Producto</label>
                  <select class="form-select" id="producto">
                    <option value="">Seleccione un producto</option>
                    {% for item in inventario %}
                      <option value="{{ item.id }}" data-precio="{{ item.precio }}">{{ item.nombre }} - {{ item.precio }}</option>
                    {% endfor %}
                  </select>
                </div>
                <div class="col-md-4">
                  <label class="form-label">Cantidad</label>
                  <input type="number" id="cantidad" min="1" value="1" class="form-control" />
                </div>
                <div class="col-12">
                  <button type="button" id="calcular" class="btn btn-primary">
                    <i class="fas fa-calculator me-1"></i>Calcular Total
                  </button>
                </div>
              </form>
              <div class="mt-3 p-3 bg-light rounded">
                <h5><strong>Total: $<span id="total">0</span></strong></h5>
              </div>
            </div>
          </div>
        </div>
        
        <div class="col-md-6">
          <div class="card">
            <div class="card-header">
              <h5><i class="fas fa-chart-bar me-2"></i>Estadísticas Rápidas</h5>
            </div>
            <div class="card-body">
              <div class="row text-center">
                <div class="col-6">
                  <div class="p-3 bg-primary text-white rounded">
                    <h4>{{ inventario.count }}</h4>
                    <small>Productos</small>
                  </div>
                </div>
                <div class="col-6">
                  <div class="p-3 bg-success text-white rounded">
                    <h4>{{ inventario|length }}</h4>
                    <small>Disponibles</small>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <div class="card mt-3">
            <div class="card-header">
              <h5><i class="fas fa-clock me-2"></i>Ventas Recientes</h5>
            </div>
            <div class="card-body">
              {% if ventas_recientes %}
                <div class="list-group" style="max-height: 300px; overflow-y: auto;">
                  {% for venta in ventas_recientes %}
                    <div class="list-group-item d-flex justify-content-between align-items-center">
                      <div>
                        <strong>{{ venta.cliente.nombreCompleto }}</strong>
                        <br>
                        <small class="text-muted">{{ venta.fecha_venta|date:"d/m/Y H:i" }}</small>
                      </div>
                      <span class="badge bg-success rounded-pill">${{ venta.total|floatformat:2 }}</span>
                    </div>
                  {% endfor %}
                </div>
              {% else %}
                <div class="text-center text-muted">
                  <i class="fas fa-shopping-cart fa-2x mb-2"></i>
                  <p>No hay ventas recientes</p>
                </div>
              {% endif %}
            </div>
          </div>
          
          <div class="card mt-3">
            <div class="card-header">
              <h5><i class="fas fa-list me-2"></i>Productos Disponibles</h5>
            </div>
            <div class="card-body">
              <div class="list-group" style="max-height: 200px; overflow-y: auto;">
                {% for item in inventario %}
                  <div class="list-group-item d-flex justify-content-between align-items-center">
                    <div>
                      <strong>{{ item.nombre }}</strong>
                      <br>
                      <small class="text-muted">{{ item.categoria }} - {{ item.sub_categoria }}</small>
                    </div>
                    <span class="badge bg-primary rounded-pill">{{ item.precio }}</span>
                  </div>
                {% empty %}
                  <div class="text-center text-muted">
                    <i class="fas fa-box-open fa-2x mb-2"></i>
                    <p>No hay productos disponibles</p>
                  </div>
                {% endfor %}
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<script>
  document.getElementById('calcular').addEventListener('click', function() {
    const select = document.getElementById('producto');
    const cantidad = parseInt(document.getElementById('cantidad').value || '1');
    
    if (select.selectedIndex === 0) {
      alert('Por favor seleccione un producto');
      return;
    }
    
    // Limpiar el precio removiendo símbolos
    const precioTexto = select.options[select.selectedIndex].getAttribute('data-precio') || '0';
    const precioLimpio = precioTexto.replace('$', '').replace(',', '').replace(' ', '');
    const precio = parseFloat(precioLimpio) || 0;
    
    const total = precio * cantidad;
    document.getElementById('total').textContent = isNaN(total) ? '0' : total.toLocaleString('es-CO');
  });
  
  // Calcular automáticamente cuando cambie la cantidad o el producto
  document.getElementById('cantidad').addEventListener('input', function() {
    if (document.getElementById('producto').selectedIndex > 0) {
      document.getElementById('calcular').click();
    }
  });
  
  document.getElementById('producto').addEventListener('change', function() {
    if (this.selectedIndex > 0) {
      document.getElementById('calcular').click();
    }
  });
</script>
{% endblock %}



